(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[664],{6782:function(e,t,n){Promise.resolve().then(n.bind(n,1276))},1276:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(7437),i=n(3457),o=n(8874),s=n(3226),d=n(879),c=n(1199),l=n(8526),a=n(2265),u=n(9231);function h(e){var t,n;let{item:o,removeItem:d}=e,{products:l,getProduct:h}=(0,a.useContext)(u.StoreVitalContext);return(0,r.jsxs)(i.Z,{sx:{p:3,borderBottom:1,borderColor:c.tv},direction:"row",justifyContent:"space-between",onClick:()=>d(o.product_id),children:[(0,r.jsxs)(i.Z,{direction:"row",children:[(0,r.jsx)(s.Z,{width:240,children:null===(t=h(o.product_id))||void 0===t?void 0:t.name}),(0,r.jsxs)(s.Z,{sx:{fontWeight:700},children:["x",o.quantity]})]}),(0,r.jsxs)(s.Z,{sx:{fontWeight:700},children:["￥ ",null===(n=h(o.product_id))||void 0===n?void 0:n.price]})]})}var p=n(9027),f=n(4033),m=n(6953);function x(){let[e,t]=(0,a.useState)(""),[n,x]=(0,a.useState)({id:void 0,total_points:0,user_id:void 0,order_items:[]}),{products:g,getProduct:_,users:v}=(0,a.useContext)(u.StoreVitalContext),[j,S]=(0,a.useState)(void 0),[Z,b]=(0,a.useState)("アイテム"),{ref:w}=(0,l.T_)({onDecodeResult(e){k(parseInt(e.getText()))}}),y=(0,f.useRouter)(),{enqueueSnackbar:C}=(0,m.Ds)(),k=e=>{e.toString().startsWith("4")&&q(parseInt(e.toString().slice(1))),e.toString().startsWith("9")&&F(parseInt(e.toString().slice(1)))},I=e=>{C(e,{variant:"success",autoHideDuration:1e3,anchorOrigin:{vertical:"top",horizontal:"center"}})},F=e=>{let t=v.find(t=>t.id===e);t&&(S(t),I("".concat(t.name,"さんのカードをスキャンしました")))},q=e=>{let t=g.find(t=>t.id===e);if(console.log(t),t){let r={...n},i=r.order_items.findIndex(t=>t.product_id===e);if(i>=0){let e=r.order_items[i];e.quantity+=1}else{let e={};e.product_id=t.id,e.quantity=1,r.order_items.push({...e})}x(r),I("".concat(t.name,"を追加しました"))}},z=e=>{let t={...n},r=t.order_items.findIndex(t=>t.product_id===e);if(r>=0){let e=t.order_items[r];e.quantity-=1,e.quantity<=0&&t.order_items.splice(r,1)}x(t)},W=n.order_items.reduce((e,t)=>e+t.quantity*_(t.product_id).price,0),E=n.order_items.reduce((e,t)=>e+t.quantity,0),R=.01*W,P=()=>{let e={store_id:1,user_id:null==j?void 0:j.id,total_points:R,order_items:n.order_items.map(e=>({product_id:e.product_id,quantity:e.quantity}))};fetch("".concat("https://scan-master-server.onrender.com","/orders"),{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{console.log(e),n.id=e.id,y.push("/link_qr?orderId=".concat(e.id))}),x({id:void 0,total_points:0,user_id:void 0,order_items:[]}),S(void 0)};return(0,r.jsx)("main",{children:(0,r.jsxs)(i.Z,{direction:"row",children:[(0,r.jsxs)(i.Z,{gap:2,width:"100%",mx:4,height:"100svh",overflow:"scroll",children:[(0,r.jsx)(p.h,{selected:Z,setSelected:b}),"アイテム"==Z&&(0,r.jsx)(o.ZP,{container:!0,spacing:2,children:g.map(e=>(0,r.jsx)(o.ZP,{item:!0,sm:6,md:4,lg:3,children:(0,r.jsxs)(i.Z,{component:"a",onClick:()=>q(e.id),children:[(0,r.jsx)("img",{src:e.image_url,width:"100%",style:{aspectRatio:1,objectFit:"cover",borderRadius:8}}),(0,r.jsx)(i.Z,{alignItems:"center",width:"100%",p:1,children:(0,r.jsx)(s.Z,{sx:{fontSize:14,fontWeight:700,height:40,textAlign:"center"},children:e.name})})]})},e.id))}),(0,r.jsxs)(i.Z,{display:"スキャン"==Z?"flex":"none",gap:2,children:[(0,r.jsx)("video",{ref:w,style:{borderRadius:32,width:"100%"}}),(0,r.jsx)(d.Z,{value:e,onChange:e=>{t(e.target.value)},onKeyDown:n=>{"Enter"===n.key&&(k(parseInt(e)),t(""))},label:"ID手動入力"})]})]}),(0,r.jsxs)(i.Z,{width:480,minWidth:480,sx:{borderLeft:4,borderColor:c.tv,height:"100svh"},direction:"column",children:[(0,r.jsx)(i.Z,{px:2,height:"100%",overflow:"scroll",children:n.order_items.map(e=>(0,r.jsx)(h,{item:e,removeItem:z},e.product_id))}),(0,r.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",m:2,p:2,px:3,sx:{background:c.lr,color:"white",borderRadius:2},component:"div",onClick:()=>P(),children:[(0,r.jsxs)(s.Z,{sx:{fontSize:32,fontWeight:700},children:["￥",W]}),(0,r.jsxs)(i.Z,{children:[(0,r.jsxs)(s.Z,{sx:{fontSize:16,fontWeight:700,alignSelf:"flex-end"},children:[E,"点"]}),(0,r.jsxs)(s.Z,{sx:{fontSize:16,fontWeight:700},children:[null==j?void 0:j.name,j?"さま":""," お会計へ"]})]})]})]})]})})}},9231:function(e,t,n){"use strict";n.r(t),n.d(t,{StoreVitalContext:function(){return o},StoreVitalProvider:function(){return s}});var r=n(7437),i=n(2265);let o=(0,i.createContext)({}),s=e=>{let{children:t}=e,[n,s]=(0,i.useState)([]),[d,c]=(0,i.useState)([]),[l,a]=(0,i.useState)(),u=(0,i.useRef)(!0),[h,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=async()=>{let e={method:"GET",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"}};fetch("".concat("https://scan-master-server.onrender.com","/products"),e).then(e=>e.json()).then(e=>{c(e)}),fetch("".concat("https://scan-master-server.onrender.com","/users"),e).then(e=>e.json()).then(e=>{s(e);let t=localStorage.getItem("user_id");if(t){let n=e.find(e=>e.id===parseInt(t));n&&f(n)}else f(e.find(e=>9===e.id))})};u.current&&(u.current=!1,e())},[]);let f=e=>{a(e),e&&localStorage.setItem("user_id",e.id.toString())};return(0,r.jsx)(o.Provider,{value:{products:d,setProducts:c,getProduct:e=>d.find(t=>t.id===e),users:n,setUsers:s,user:l,setUser:f,getUser:e=>n.find(t=>t.id===e),open:h,setOpen:p},children:d.length>0?t:(0,r.jsx)("p",{children:"Loading... "})})}},9027:function(e,t,n){"use strict";n.d(t,{h:function(){return u}});var r=n(7437),i=n(1199),o=n(6500),s=n(4989),d=n(3457),c=n(5551),l=n(1396),a=n.n(l);function u(e){let{selected:t,setSelected:n}=e,l=[{name:"アイテム",url:"/pos"},{name:"スキャン",url:"/pos"},{name:"QR作成",url:"/qr_gen"}];return(0,r.jsx)(o.Z,{position:"static",color:"transparent",sx:{borderBottom:4,borderColor:i.tv},elevation:0,children:(0,r.jsx)(s.Z,{sx:{p:0},children:(0,r.jsx)(d.Z,{direction:"row",gap:2,m:1.5,children:l.map(e=>{let o=l.find(e=>e.name==t).url==e.url;return(0,r.jsx)(c.Z,{sx:{color:t==e.name?"black":i.X_,fontWeight:700,fontSize:24,px:3,py:.5,borderRadius:2,background:t==e.name?i.Cz:"transparent"},component:a(),href:e.url,onClick:o?()=>{n(e.name)}:void 0,children:e.name},e.name)})})})})}},1199:function(e,t,n){"use strict";n.d(t,{Cz:function(){return o},X_:function(){return s},iy:function(){return l},lr:function(){return d},tv:function(){return r},z:function(){return c},zQ:function(){return i}});let r="#E0E0E0",i="#FFFFFF",o="#F2F2F2",s="#9e9e9e",d="#2962FF",c="#72391D",l="#616161"}},function(e){e.O(0,[773,551,93,651,953,874,751,971,596,744],function(){return e(e.s=6782)}),_N_E=e.O()}]);